/*!
 * tofojs v1.1.5 (http://tofujs.goodgame.com)
 * Copyright 2015-2016 tofojs.goodgame.asia
 * Author vtejuf@163.com
 * BSD License
 */
function Tofu(a,b){function h(a,b){this.name=a,this.controller=f.module_base+"/"+a+"/js/controller.js",this.container=b,this.template,this.config=f,this.config.staticstamp=g,+function(){}(this)}function i(a){var b=j(a),c=b[0],d=b[1],f={},g=0,h="",i=document.createElement("style");c.length>0?(c.forEach(function(b){e.tools.doAsync({url:b},function(c){f[b]=k(c,a.name),g++})}),setTimeout(function(){return g==c.length?(c.forEach(function(a){h+=f[a]}),i.innerHTML=h+d,i.setAttribute("data-tofu-depend-css",a.name),document.head.appendChild(i),void 0):(setTimeout(arguments.callee,100),void 0)},100)):""!=d&&(i.innerHTML=d,i.setAttribute("data-tofu-depend-css",a.name),document.head.appendChild(i))}function j(a){var g,b=a.template,c=/<link [\s\S]*?href=[\'\"]([ \S]+?)[\'\"][\s\S]*?>/gm,d=[];return b=b.replace(c,function(){var b=e.tools.resolve(RegExp.$1,f.module_base+"/"+a.name+"/");return d.push(b),""}),g="",c=/<style[\s\S]*?>([\s\S]*?)<\/style>/gm,b=b.replace(c,function(){return g+=k(RegExp.$1,a.name),""}),a.template=b,[d,g]}function k(a,b){var c="";return a=a.replace(/(?:\t|[\n\r]|\/\*[\s\S]*?\*\/)/gm,"").replace(/@[\s\S]+?\}\}/g,function(a){return c+=a,""}).replace(/(^|\})(\s|\})*([^@\d\}\s][\s\S]*?)\{/g,function(){var a=RegExp.$3,c=RegExp.$1,d=RegExp.$2;return a.indexOf(",")>-1&&(a=a.replace(/,/g,","+b+" ")),c+(d.trim()?"}":"")+"[data-tofu-module="+b+"] "+a+"{"}),c+a}function l(a){if(f.loadScript)return f.loadScript(a.name,a.container,a.template),void 0;var b=document.createElement("script");b.type="text/javascript",b.src=a.controller+g,b.onload=function(){document.head.removeChild(b)},document.head.appendChild(b)}function m(a){function e(){4==d.readyState&&(0==d.status||200==d.status||304==d.status)&&(a.template=d.responseText.replace(/(<!--[\s\S]*?-->|\t|[\n\r])/gm,"").replace(/{{Tofu.(.+?)}}/gm,function(a,c){return b[c]||c}),i(a),l(a))}var b={module_url:f.module_base+"/"+a.name},c=f.module_base+"/"+a.name+"/index.html"+g,d=new XMLHttpRequest;d.onreadystatechange=e,d.open("GET",c,f.async),d.setRequestHeader("Content-Type","text/html"),d.setRequestHeader("charset","utf-8"),d.send(null)}function n(){var a,b,c,f,g;if(!d||!e.event[d])for(b="string"==typeof d?document.querySelectorAll('[data-tofu-module="'+d+'"]'):document.querySelectorAll("[data-tofu-module]"),c=0,f=b.length;f>c;c++)g=b[c].getAttribute("data-tofu-module"),""!=g&&(a=new h(g,b[c]),e.event[g]||(e.event[g]={},e.event[g].$tofu=a,m(a)))}var c={async:!0,staticStamp:!1,module_base:"/modules"},d=a,e=arguments.callee,f=e.tools.json_merge({},c,e.config,b),g=f.staticStamp?"?"+f.staticStamp.toLowerCase():"";h.prototype.remove=function(a){a&&this.container.parentNode.removeChild(this.container),delete e.event[this.name]},h.prototype.addEventListener=function(a,b){return b?(e.event[this.name][a]=b.bind(this),void 0):!1},h.prototype.dispatchEvent=function(a,b,c){e.event[a][b]&&e.event[a][b](c)},h.prototype.removeEventListener=function(a){!!e.event[this.name][a]&&delete e.event[this.name][a]},h.prototype.on=function(){"function"==typeof arguments[1]?this.addEventListener.apply(this,arguments):this.dispatchEvent.apply(this,arguments)},h.prototype.off=function(){this.removeEventListener.apply(this,arguments)},h.prototype.render=function(a,b){var f,g,h,i,j,k,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},d=function(a){var b=function(b){return a[b]},c="(?:"+Object.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};return d(c),f={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},g=/(.)^/,h={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},i=/\\|'|\r|\n|\u2028|\u2029/g,j=function(a){return"\\"+h[a]},k=function(a){var e,k,l,b=RegExp([(f.escape||g).source,(f.interpolate||g).source,(f.evaluate||g).source].join("|")+"|$","g"),c=0,d="__p+='";a.replace(b,function(b,e,f,g,h){return d+=a.slice(c,h).replace(i,j),c=h+b.length,e?d+="'+\n((__t=(typeof "+e+"!='undefined'?"+e+":null))==null?'':escape(__t))+\n'":f?d+="'+\n((__t=(typeof "+f+"!='undefined'?"+f+":null))==null?'':__t)+\n'":g&&(d+="';\n"+g+"\n__p+='"),b}),d+="';\n",f.variable||(d="with(obj||{}){\n"+d+"}\n"),d="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+d+"return __p;\n";try{e=new Function(f.variable||"obj",d)}catch(h){throw h.source=d,h}return k=function(a){return e.call(this,a)},l=f.variable||"obj",k.source="function("+l+"){\n"+d+"}",k},"string"==typeof a||"undefined"==typeof a?(b=a,a=void 0,k(b||this.template)):k(b||this.template)(a)},n()}Tofu.event={},Tofu.ready=function(a,b,c){var d,e,f;if("function"==typeof b&&(c=b,b=[]),d=Tofu.event[a].$tofu,delete Tofu.event[a].$tofu,e=b.length,0==e)Tofu.event[a].isReady=!0,Tofu.event[a].ready=c.bind(d)||function(){},Tofu.event[a].ready(),Tofu.event[a].onready&&Tofu.event[a].onready(d.name,d.container,d.template);else{f=0;do+function(f){var j,g=Tofu.tools.getDepsUri(b[f],d.controller),h=g.uri+d.config.staticstamp,i=g.type;"js"==i?(j=document.createElement("script"),j.setAttribute("data-tofu-depend-js",a),j.type="text/javascript",j.src=h):"css"==i&&(j=document.createElement("link"),j.setAttribute("data-tofu-depend-css",a),j.type="text/css",j.rel="stylesheet",j.href=h),j.onload=function(){"css"!=i&&document.head.removeChild(j),f>=e-1&&(Tofu.event[a].isReady=!0,Tofu.event[a].ready=c.bind(d)||function(){},Tofu.event[a].ready(),Tofu.event[a].onready&&Tofu.event[a].onready(d.name,d.container,d.template))},j.onerror=function(){document.head.removeChild(j)},document.head.appendChild(j)}(f);while(++f<e)}},Tofu.isReady=function(a){return!!this.event[a]&&this.event[a].isReady},Tofu.config=function(a){this.config=a},Tofu.removeModule=function(a,b){var d,e,c=document.querySelector('[data-tofu-module="'+a+'"]');for(b&&c&&c.parentNode.removeChild(c),c&&delete this.event[a],d=document.querySelectorAll('[data-tofu-depend-css="'+a+'"]'),e=d.length-1;e>=0;e--)document.head.removeChild(d[e])},Tofu.on=function(a,b,c){this.event[a][b]&&this.event[a][b](c)},Tofu.onReady=function(a,b){this.event[a].onready=b.bind(null)},Tofu.tools={json_merge:function(){for(var d,e,a=arguments.length,b=0,c=arguments[0];++b<a;)if(d=arguments[b],"object"==typeof d)for(e in d)c[e]=d[e];return c},doAsync:function(a,b){var f,g,c={method:"GET",async:!0,dataType:"text",url:null,header:null},d=["POST","GET","PUT","DELETE"];if(a=this.json_merge(c,a),null==a.url)return!1;if("string"!=typeof a.dataType&&(a.dataType="text"),a.dataType=a.dataType.toLowerCase(),"string"!=typeof a.method&&(a.method="GET"),a.method=a.method.toUpperCase(),d.indexOf(a.method)<0&&(a.method="GET"),f=new XMLHttpRequest,f.open(a.method,a.url,a.async),null!==a.header)for(g in a.header)f.setRequestHeader(g,a.header[g]);f.onreadystatechange=function(){if(4==f.readyState&&(0==f.status||200==f.status||304==f.status))switch(a.dataType){case"json":b(JSON.parse(f.responseText));break;default:b(f.responseText)}},f.send(null)},loadScript:function(a){var c,b={module_name:null,onload:function(){},onerror:function(){}};a=this.json_merge(b,a),c=document.createElement("script"),a.module_name&&c.setAttribute("data-tofu-depend-js",a.module_name),c.type="text/javascript",c.src=a.src,c.onload=function(){document.head.removeChild(c),a.onload()},c.onerror=function(){document.head.removeChild(c),a.onerror()},document.head.appendChild(c)},getCurrentScript:function(){var a,c,e,d;if(document.currentScript)return document.currentScript.src;try{null.a}catch(b){a=b.stack,!a&&window.opera&&(a=(String(b).match(/of linked script \S+/g)||[]).join(" "))}if(a)return a=a.split(/[@ ]/g).pop(),a="("==a[0]?a.slice(1,-1):a,a.replace(/(:\d+)?:\d+$/i,"");for(c=document.head.getElementsByTagName("script"),d=0;e=c[d++];)if("interactive"===e.readyState)return e.className=e.src},resolve:function(a,b){var f,c=location.protocol+"//"+location.host,d={rel:/^\./,abs:/^\//},e={host:new RegExp("^(?:"+c+"|"+location.host+")/"),dbs:/\/\//g,dots:/(?:\/\.\/|\/(?:.[^\/])\/\.\.\/)/g};switch(a=a.replace(e.host,"/"),!0){case d.rel.test(a):b=c+"/"+b.replace(e.host,"./"),f=b.substr(0,b.lastIndexOf("/")+1),a=f+a.replace(e.dbs,"/"),a=a.replace(e.dots,"/");break;case d.abs.test(a):a=c+a.replace(e.dbs,"/"),a=a.replace(e.dots,"/")}return a},getDepsUri:function(a,b){var d,c=document.createElement("a");return c.href=Tofu.tools.resolve(a,b),/\.(js|css)$/i.test(c.pathname)||(c.pathname+=".js"),d={uri:c.href,type:c.pathname.split(".").pop()},c=null,d}},Tofu.version="1.1.4",window.$tf=Tofu;